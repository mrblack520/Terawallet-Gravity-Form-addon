window.GFterawalletAdmin=null,function(d){function t(){var c=this;this.accountSettingsLocked=!1,this.deauthActionable=!1,this.inputContainerPrefix=gforms_terawallet_admin_strings.input_container_prefix,this.inputPrefix=gforms_terawallet_admin_strings.input_prefix,this.liveDependencySupported=gforms_terawallet_admin_strings.liveDependencySupported,this.apiMode=gforms_terawallet_admin_strings.apiMode,this.init=function(){this.initKeyStatus("live_publishable_key"),this.initKeyStatus("live_secret_key"),this.initKeyStatus("test_publishable_key"),this.initKeyStatus("test_secret_key"),this.bindDeauthorize(),this.liveDependencySupported||this.bindAPIModeChange(),this.maybeLockAccountSettings(),this.bindWebhookAlert()},this.validateKey=function(t,e){0!=e.length?(d("#"+t).val(e.trim()),this.setKeyStatusIcon(t,"<img src='"+gforms_terawallet_admin_strings.spinner+"'/>"),"live_publishable_key"==t||"test_publishable_key"==t?this.validatePublishableKey(t,e):this.validateSecretKey(t,e)):this.setKeyStatus(t,"")},this.validateSecretKey=function(e,t){d.post(ajaxurl,{action:"gf_validate_secret_key",keyName:e,key:t,nonce:gforms_terawallet_admin_strings.ajax_nonce},function(t){"valid"==(t=t.trim())?c.setKeyStatus(e,"1"):"invalid"==t?c.setKeyStatus(e,"0"):c.setKeyStatusIcon(e,gforms_terawallet_admin_strings.validation_error)})},this.validatePublishableKey=function(i,t){this.setKeyStatusIcon(i,"<img src='"+gforms_terawallet_admin_strings.spinner+"'/>"),cc={number:"4916433572511762",exp_month:"01",exp_year:(new Date).getFullYear()+1,cvc:"111",name:"Test Card"},terawallet.setPublishableKey(t),terawallet.card.createToken(cc,function(t,e){200!=t&&(400!=t&&402!=t||"live_publishable_key"!=i)?c.setKeyStatus(i,"0"):c.setKeyStatus(i,"1")})},this.initKeyStatus=function(t){var e=d("#"+t+"_is_valid"),i=d("#"+t);0<e.length?this.setKeyStatus(t,e.val()):0<i.length&&this.validateKey(t,i.val())},this.setKeyStatus=function(t,e){d("#"+t+"_is_valid").val(e);var i="";"1"==e?i='<i class="fa icon-check fa-check gf_valid"></i>':"0"==e&&(i='<i class="fa icon-remove fa-times gf_invalid"></i>'),this.setKeyStatusIcon(t,i)},this.setKeyStatusIcon=function(t,e){var i=d("#"+t+"_status_icon");0<i.length&&i.remove(),d("#"+t).after("<span id='"+t+"_status_icon'>&nbsp;&nbsp;"+e+"</span>")},this.bindDeauthorize=function(){d(".gform_terawallet_deauth_button").on("click",function(t){if(t.preventDefault(),c.accountSettingsLocked)return window.location.reload(),!1;var e=d(".gform_terawallet_deauth_button"),i=d(".deauth_scope"),n=gforms_terawallet_admin_strings.disconnect,s=d(this).data("mode"),a=d(this).data("fid");if(c.deauthActionable){var o=d("#"+s+"_deauth_scope0").is(":checked")?"site":"account",r="site"==o&&""!==a?n.feed:n[o];if(!confirm(r))return!1;e.attr("disabled","disabled"),d.ajax({async:!1,url:ajaxurl,dataType:"json",method:"POST",data:{action:"gfterawallet_deauthorize",scope:o,fid:a,id:d(this).data("id"),mode:s,nonce:gforms_terawallet_admin_strings.ajax_nonce},success:function(t){t.success?window.location.reload():alert(t.data.message),$button.removeAttr("disabled")}})}else e.eq(0).hide(),""!==a&&d(".connected_to_terawallet_text").hide(),i.show("slow",function(){c.deauthActionable=!0})})},this.bindAPIModeChange=function(){""!==this.apiMode&&void 0!==this.apiMode||(this.apiMode="live",d("#api_mode0").prop("checked",!0));var e="live"===this.apiMode?"test":"live";d("#"+this.inputContainerPrefix+this.apiMode+"_auth_token").show(),d("#"+this.inputContainerPrefix+e+"_auth_token").hide(),d('#tab_gravityformsterawallet input[name="'+this.inputPrefix+'_api_mode"]').on("click",function(t){c.apiMode=d(this).val(),e="live"===c.apiMode?"test":"live",d("#"+c.inputContainerPrefix+e+"_auth_token").hide(),d("#"+c.inputContainerPrefix+c.apiMode+"_auth_token").show()})},this.maybeLockAccountSettings=function(){d("#"+this.inputContainerPrefix+"connected_to").siblings("#"+this.inputContainerPrefix+"api_mode, #"+this.inputContainerPrefix+"live_auth_token, #"+this.inputContainerPrefix+"test_auth_token").hide(),d("#gform_terawallet_change_account").on("click",function(){if(d(this).data("disabled"))alert(gforms_terawallet_admin_strings.switch_account_disabled_message);else{d("#"+c.inputContainerPrefix+"api_mode").show();var t="live"===c.apiMode?"test":"live";d("#"+c.inputContainerPrefix+t+"_auth_token").hide(),d("#"+c.inputContainerPrefix+c.apiMode+"_auth_token").show(),d(this).off("click").addClass("disabled")}}),d("table.gforms_form_settings").on("change","input, select",function(){var t=d(this).attr("name");t!==c.inputPrefix+"_api_mode"&&"deauth_scope"!==t&&t!==c.inputPrefix+"_transactionType"&&(c.accountSettingsLocked=!0)}),d("#gform-settings-save").on("click",function(){d(".error.below-h2").remove(),c.accountSettingsLocked=!1}),window.addEventListener("beforeunload",function(t){(c.accountSettingsLocked||d(".error.below-h2").length)&&(t.preventDefault(),t.returnValue="")})},this.bindWebhookAlert=function(){d("#gform_terawallet_change_account").length&&""===d("#"+this.apiMode+"_signing_secret").val()&&(d("#webhooks_enabled").focus(),d([document.documentElement,document.body]).animate({scrollTop:d("#"+c.inputContainerPrefix+"api_mode").offset().top+20},1e3))},this.init()}d(document).ready(function(){GFterawalletAdmin=new t})}(jQuery);